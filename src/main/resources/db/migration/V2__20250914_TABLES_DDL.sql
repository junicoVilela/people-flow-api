-- ============================
-- ORGANIZAÇÃO / NÚCLEO
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.CLIENTE (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME TEXT NOT NULL,
    CNPJ VARCHAR(18),
    STATUS TEXT NOT NULL DEFAULT 'ativo',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.EMPRESA (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    CNPJ VARCHAR(18),
    INSCRICAO_ESTADUAL TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.UNIDADE (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    EMPRESA_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    CODIGO TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.DEPARTAMENTO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    EMPRESA_ID BIGINT NOT NULL,
    UNIDADE_ID BIGINT,
    NOME TEXT NOT NULL,
    CODIGO TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.CENTRO_CUSTO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    CODIGO TEXT NOT NULL,
    NOME TEXT NOT NULL,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- SEGURANÇA / RBAC
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.USUARIO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    EMAIL TEXT NOT NULL,
    STATUS TEXT NOT NULL DEFAULT 'ativo',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.PAPEL (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    DESCRICAO TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.PERMISSAO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    RECURSO TEXT NOT NULL,
    ACAO TEXT NOT NULL,
    DESCRICAO TEXT
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.USUARIO_PAPEL (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    USUARIO_ID BIGINT NOT NULL,
    PAPEL_ID BIGINT NOT NULL,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.PAPEL_PERMISSAO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    PAPEL_ID BIGINT NOT NULL,
    PERMISSAO_ID BIGINT NOT NULL
);

-- ============================
-- PESSOAS / COLABORADORES
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.COLABORADOR (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    EMPRESA_ID BIGINT NOT NULL,
    DEPARTAMENTO_ID BIGINT,
    CENTRO_CUSTO_ID BIGINT,
    NOME TEXT NOT NULL,
    CPF VARCHAR(14),
    MATRICULA VARCHAR(20),
    EMAIL TEXT,
    DATA_ADMISSAO DATE,
    DATA_DEMISSAO DATE,
    STATUS TEXT NOT NULL DEFAULT 'ativo',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.DEPENDENTE (
     ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
     CLIENTE_ID BIGINT NOT NULL,
     COLABORADOR_ID BIGINT NOT NULL,
     NOME TEXT NOT NULL,
     PARENTESCO TEXT NOT NULL,
     DATA_NASCIMENTO DATE,
     CPF VARCHAR(14)
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.CONTA_BANCARIA (
     ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
     CLIENTE_ID BIGINT NOT NULL,
     COLABORADOR_ID BIGINT NOT NULL,
     BANCO TEXT NOT NULL,
     AGENCIA TEXT NOT NULL,
     CONTA TEXT NOT NULL,
     TIPO TEXT,
     PIX TEXT
);

-- ============================
-- JORNADA & CARGOS
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.JORNADA_TRABALHO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    DESCRICAO TEXT NOT NULL,
    CARGA_SEMANAL_HORAS NUMERIC(5,2),
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.CARGO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    DESCRICAO TEXT,
    NIVEL TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.FAIXA_SALARIAL (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    CARGO_ID BIGINT NOT NULL,
    FAIXA_MIN NUMERIC(14,2) NOT NULL,
    FAIXA_MAX NUMERIC(14,2) NOT NULL,
    MOEDA TEXT DEFAULT 'BRL',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.COLABORADOR_CARGO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    CARGO_ID BIGINT NOT NULL,
    CENTRO_CUSTO_ID BIGINT,
    SALARIO NUMERIC(14,2),
    INICIO DATE NOT NULL,
    FIM DATE,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- CONTRATOS
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.CONTRATO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    JORNADA_ID BIGINT NOT NULL,
    CARGO_ID BIGINT NOT NULL,
    TIPO TEXT,
    REGIME TEXT,
    SALARIO_BASE NUMERIC(14,2),
    INICIO DATE NOT NULL,
    FIM DATE,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- PONTO
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.MARCACAO_PONTO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    DATA_HORA TIMESTAMPTZ NOT NULL,
    TIPO TEXT NOT NULL, -- entrada/saida
    ORIGEM TEXT,        -- kiosk/mobile/import
    LATITUDE NUMERIC(9,6),
    LONGITUDE NUMERIC(9,6),
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.CALCULO_PONTO_DIA (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    DATA DATE NOT NULL,
    HORAS_TRABALHADAS NUMERIC(6,2) DEFAULT 0,
    HORAS_EXTRAS NUMERIC(6,2) DEFAULT 0,
    BANCO_HORAS_SALDO NUMERIC(7,2) DEFAULT 0,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.AUSENCIA (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    TIPO TEXT NOT NULL,  -- atestado, falta, justificada
    INICIO TIMESTAMPTZ NOT NULL,
    FIM TIMESTAMPTZ NOT NULL,
    JUSTIFICATIVA TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- FÉRIAS
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.FERIAS_SOLICITACAO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    INICIO DATE NOT NULL,
    FIM DATE NOT NULL,
    ABONO BOOLEAN DEFAULT FALSE,
    STATUS TEXT NOT NULL DEFAULT 'pendente',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.FERIAS_APROVACAO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    SOLICITACAO_ID BIGINT NOT NULL,
    APROVADOR_USUARIO_ID BIGINT NOT NULL,
    STATUS TEXT NOT NULL, -- aprovado/reprovado
    OBSERVACAO TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.FERIAS_SALDO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    DIAS_AQUISITIVOS INTEGER DEFAULT 0,
    DIAS_DISPONIVEIS INTEGER DEFAULT 0,
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- BENEFÍCIOS
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.PLANO_BENEFICIO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    TIPO TEXT NOT NULL, -- VT/VR/Saude/Outro
    NOME TEXT NOT NULL,
    FORNECEDOR TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.ADESAO_BENEFICIO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    PLANO_ID BIGINT NOT NULL,
    INICIO DATE NOT NULL,
    FIM DATE,
    CUSTO_MENSAL NUMERIC(12,2),
    COTA_COLABORADOR NUMERIC(12,2),
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- RECRUTAMENTO
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.VAGA (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    TITULO TEXT NOT NULL,
    DESCRICAO TEXT,
    DEPARTAMENTO_ID BIGINT,
    LOCALIDADE TEXT,
    REMOTO BOOLEAN DEFAULT FALSE,
    STATUS TEXT NOT NULL DEFAULT 'aberta',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.CANDIDATO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    EMAIL TEXT,
    TELEFONE TEXT,
    CPF VARCHAR(14),
    CONSENTIMENTO_LGPD BOOLEAN DEFAULT TRUE,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.CANDIDATURA (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    VAGA_ID BIGINT NOT NULL,
    CANDIDATO_ID BIGINT NOT NULL,
    DATA_CANDIDATURA DATE NOT NULL,
    ETAPA_ATUAL TEXT,
    STATUS TEXT NOT NULL DEFAULT 'em_analise',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.ENTREVISTA (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    CANDIDATURA_ID BIGINT NOT NULL,
    ENTREVISTADOR_USUARIO_ID BIGINT NOT NULL,
    AGENDADA_EM TIMESTAMPTZ NOT NULL,
    TIPO TEXT,
    FEEDBACK TEXT,
    RESULTADO TEXT, -- aprovado/reprovado/pendente
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- DESEMPENHO
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.CICLO_DESEMPENHO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    INICIO DATE NOT NULL,
    FIM DATE NOT NULL,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.AVALIACAO_DESEMPENHO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    CICLO_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    AVALIADOR_USUARIO_ID BIGINT NOT NULL,
    NOTA NUMERIC(4,2),
    COMENTARIOS TEXT,
    STATUS TEXT NOT NULL DEFAULT 'rascunho',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- OKR
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.OKR (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    TIPO TEXT NOT NULL, -- organizacional/equipe/pessoal
    TITULO TEXT NOT NULL,
    DESCRICAO TEXT,
    RESPONSAVEL_USUARIO_ID BIGINT,
    INICIO DATE,
    FIM DATE,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.OKR_RESULTADO_CHAVE (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    OKR_ID BIGINT NOT NULL,
    TITULO TEXT NOT NULL,
    UNIDADE TEXT, -- percentual/numero
    VALOR_ALVO NUMERIC(14,2),
    VALOR_ATUAL NUMERIC(14,2) DEFAULT 0
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.OKR_CHECKIN (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    RESULTADO_CHAVE_ID BIGINT NOT NULL,
    REALIZADO_EM TIMESTAMPTZ NOT NULL,
    VALOR NUMERIC(14,2),
    COMENTARIO TEXT,
    USUARIO_ID BIGINT
);

-- ============================
-- PDI & COMPETÊNCIAS
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.PDI (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    CICLO_ID BIGINT,
    OBJETIVO TEXT NOT NULL,
    ACOES JSONB NOT NULL DEFAULT '[]'::jsonb,
    STATUS TEXT NOT NULL DEFAULT 'aberto',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.COMPETENCIA_CARGO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    CARGO_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    NIVEL_ESPERADO INTEGER,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- REEMBOLSOS
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.POLITICA_REEMBOLSO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    CATEGORIA TEXT NOT NULL,
    VALOR_MAX_POR_DIA NUMERIC(12,2),
    MOEDA TEXT DEFAULT 'BRL',
    EXIGE_DOCUMENTO BOOLEAN DEFAULT TRUE
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.REEMBOLSO_SOLICITACAO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    CATEGORIA TEXT NOT NULL,
    VALOR_TOTAL NUMERIC(14,2) NOT NULL DEFAULT 0,
    STATUS TEXT NOT NULL DEFAULT 'pendente',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.REEMBOLSO_ITEM (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    SOLICITACAO_ID BIGINT NOT NULL,
    DESCRICAO TEXT NOT NULL,
    VALOR NUMERIC(14,2) NOT NULL,
    DATA DATE NOT NULL
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.REEMBOLSO_APROVACAO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    SOLICITACAO_ID BIGINT NOT NULL,
    APROVADOR_USUARIO_ID BIGINT NOT NULL,
    STATUS TEXT NOT NULL, -- aprovado/reprovado
    OBSERVACAO TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- FOLHA DE PAGAMENTO
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.RUBRICA (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    CODIGO TEXT NOT NULL,
    DESCRICAO TEXT NOT NULL,
    TIPO TEXT NOT NULL, -- provento/desconto
    BASE_CALCULO JSONB DEFAULT '{}'::jsonb
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.FOLHA_EXECUCAO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COMPETENCIA DATE NOT NULL, -- use o dia 1 do mês
    STATUS TEXT NOT NULL DEFAULT 'aberta',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.FOLHA_ITEM (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    EXECUCAO_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    RUBRICA_ID BIGINT NOT NULL,
    QUANTIDADE NUMERIC(12,2) DEFAULT 1,
    VALOR NUMERIC(14,2) NOT NULL
);

-- ============================
-- ESOCIAL
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.EVENTO_ESOCIAL (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    TIPO TEXT NOT NULL, -- S-1000, S-2200, S-1200...
    REFERENCIA_ID BIGINT,
    STATUS TEXT NOT NULL DEFAULT 'gerado',
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.PAYLOAD_ESOCIAL (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EVENTO_ID BIGINT NOT NULL,
    VERSAO_LAYOUT TEXT,
    XML TEXT,
    RECIBO TEXT,
    PROTOCOLO TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- WORKFLOW
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.DEFINICAO_WORKFLOW (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    DESCRICAO TEXT,
    MODELO JSONB NOT NULL DEFAULT '{}'::jsonb,
    VERSAO INTEGER NOT NULL DEFAULT 1
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.INSTANCIA_WORKFLOW (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    DEFINICAO_ID BIGINT NOT NULL,
    ENTIDADE TEXT NOT NULL,
    ENTIDADE_ID BIGINT NOT NULL,
    STATUS TEXT NOT NULL DEFAULT 'em_andamento',
    CONTEXTO JSONB NOT NULL DEFAULT '{}'::jsonb,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.TAREFA_WORKFLOW (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    INSTANCIA_ID BIGINT NOT NULL,
    RESPONSAVEL_USUARIO_ID BIGINT,
    ETAPA TEXT NOT NULL,
    STATUS TEXT NOT NULL DEFAULT 'aberta',
    PRAZO DATE,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.LOG_WORKFLOW (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    INSTANCIA_ID BIGINT NOT NULL,
    MENSAGEM TEXT NOT NULL,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- AUDITORIA
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.EVENTO_AUDITORIA (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    USUARIO_ID BIGINT,
    ENTIDADE TEXT NOT NULL,
    ENTIDADE_ID BIGINT,
    ACAO TEXT NOT NULL, -- create/update/delete
    DADOS JSONB NOT NULL DEFAULT '{}'::jsonb,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- NOTIFICAÇÕES
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.TEMPLATE_NOTIFICACAO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    NOME TEXT NOT NULL,
    CANAL TEXT NOT NULL CHECK (CANAL IN ('email','push','inapp')),
    ASSUNTO TEXT,
    CORPO TEXT NOT NULL,
    VARIAVEIS JSONB NOT NULL DEFAULT '{}'::jsonb,
    VERSAO INTEGER NOT NULL DEFAULT 1,
    ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.NOTIFICACAO_ENVIO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    TEMPLATE_ID BIGINT,
    USUARIO_ID BIGINT,
    COLABORADOR_ID BIGINT,
    CANAL TEXT NOT NULL CHECK (CANAL IN ('email','push','inapp')),
    ASSUNTO TEXT,
    CORPO_RENDERIZADO TEXT NOT NULL,
    CONTEXTO JSONB NOT NULL DEFAULT '{}'::jsonb,
    STATUS TEXT NOT NULL DEFAULT 'pendente' CHECK (STATUS IN ('pendente','enviado','erro')),
    ERRO TEXT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ENVIADO_EM TIMESTAMPTZ
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.DOCUMENTO_COLABORADOR (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    TIPO TEXT NOT NULL,
    NOME_ARQUIVO TEXT NOT NULL,
    MIME_TYPE TEXT NOT NULL,
    TAMANHO_BYTES BIGINT NOT NULL CHECK (TAMANHO_BYTES >= 0),
    STORAGE_KEY TEXT NOT NULL,
    VERSAO INTEGER NOT NULL DEFAULT 1 CHECK (VERSAO > 0),
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ============================
-- SAÚDE OCUPACIONAL
-- ============================
CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.ASO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    TIPO TEXT NOT NULL CHECK (TIPO IN ('admissional','periodico','retorno','mudanca','demissional')),
    REALIZADO_EM DATE NOT NULL,
    VALIDADE_ATE DATE,
    CLINICA TEXT,
    RESULTADO TEXT,
    DOCUMENTO_ID BIGINT,
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS PEOPLE_FLOW_RH.EXAME_AGENDAMENTO (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID BIGINT NOT NULL,
    COLABORADOR_ID BIGINT NOT NULL,
    TIPO_EXAME TEXT NOT NULL,
    CLINICA TEXT,
    AGENDADO_EM TIMESTAMPTZ NOT NULL,
    REALIZADO_EM TIMESTAMPTZ,
    COMPARECEU BOOLEAN,
    STATUS TEXT NOT NULL DEFAULT 'agendado' CHECK (STATUS IN ('agendado','realizado','faltou','cancelado')),
    CRIADO_EM TIMESTAMPTZ NOT NULL DEFAULT now(),
    ATUALIZADO_EM TIMESTAMPTZ NOT NULL DEFAULT now()
);